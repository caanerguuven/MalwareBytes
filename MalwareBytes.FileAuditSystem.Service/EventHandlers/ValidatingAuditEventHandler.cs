using MalwareBytes.FileAuditSystem.Domain.Entity;
using MalwareBytes.FileAuditSystem.Service.Abstract;
using System.Diagnostics.Eventing.Reader;
using System.IO;
using System.Threading.Tasks;

namespace MalwareBytes.FileAuditSystem.Service.EventHandlers
{
    public class ValidatingAuditEventHandler : AuditEventHandler
    {
        public async override Task HandleRequest(EventRecordWrittenEventArgs source, EventEntity target)
        {
           
                if (source?.EventRecord == null)
                {
                    throw new EventLogException("Event could not be found !");
                }

                if (source.EventException != null)
                {
                    throw source.EventException;
                }
                var fileName = source.EventRecord.Properties[6].Value.ToString();
                if (Directory.GetParent(fileName).FullName == target.FolderPath)
                {
                    if (_nextHandler != null)
                    {
                        await _nextHandler.HandleRequest(source, target);
                    }
                }
           

        }
    }
}
