using MalwareBytes.FileAuditSystem.Domain.Entity;
using MalwareBytes.FileAuditSystem.Service.Abstract;
using System.Diagnostics.Eventing.Reader;
using System.IO;
using System.Threading.Tasks;

namespace MalwareBytes.FileAuditSystem.Service.EventHandlers
{
    public class CollectingAuditEventHandler : AuditEventHandler
    {
        public async override Task HandleRequest(EventEntity eventEntity)
        {
            eventEntity.EventTime = EventRecord.TimeCreated.Value.ToUniversalTime().ToString("o");
            eventEntity.FileName = Path.GetFileName(EventRecord.Properties[6].Value.ToString());
            eventEntity.ProcessID = EventRecord.ProcessId.Value.ToString();
            eventEntity.Domain = EventRecord.Properties[2].Value.ToString();
            eventEntity.User = EventRecord.Properties[1].Value.ToString();

            await _nextHandler?.HandleRequest(eventEntity);
        }
    }
}
